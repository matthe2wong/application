<?php $this->headTitle('数据统计') ?>
<?php $this->headTitle('系统操作日志') ?>
<?php $this->headLink()->appendStylesheet('/template/dist/css/plugins/jquery-dataTables.min.css') ?>
<?php $this->headScript()->appendFile('/template/dist/assets/plugins/jquery-datatables/js/jquery.dataTables.js') ?>
<?php $this->headScript()->appendFile('/template/dist/assets/plugins/jquery-datatables/js/dataTables.tableTools.js') ?>
<?php $this->headScript()->appendFile('/template/dist/assets/plugins/jquery-datatables/js/dataTables.bootstrap.js') ?>
<?php //$this->headScript()->appendFile('http://cdn.hcharts.cn/highcharts/highcharts.js') ?>
<?php //$this->headScript()->appendFile('http://cdn.hcharts.cn/highcharts/modules/exporting.js') ?>
<?php $this->headLink()->appendStylesheet('/assets/admin/xt-log/statistics.css') ?>
<?php $this->headScript()->appendFile('/assets/admin/xt-log/statistics.js') ?>

<div class="page-subheading page-subheading-md">
    <ol class="breadcrumb">
        <li><a href="javascript:;">控制面板</a></li>
        <li><a href="/admin/xt-log/manage">系统操作日志管理</a></li>
        <li class="active"><a href="javascript:;">数据统计</a></li>
    </ol>
</div>
<div class="page-heading page-heading-md">
    <h2>
        <i class="fa fa-bar-chart-o"></i> 系统操作日志数据统计 
        <a href="javascript: history.go(-1)" class="btn btn-default pull-right">
    	    <i class="fa fa-chevron-left"></i> 返回</a>
    </h2>
</div>

<div class="container-fluid-md">
    <div class="panel panel-primary">
        <div class="panel-heading">
            <h4 class="panel-title"><i class="fa fa-fw fa-bar-chart-o"></i> 数据占比统计</h4>

            <div class="panel-options">
            </div>
        </div>
        <ul class="nav nav-tabs">
			<li class="active"><a data-toggle="tab" href="#tab-resource-name">资源名称</a></li>
			<li><a data-toggle="tab" href="#tab-sys-user-name">用户名称</a></li>
			<li><a data-toggle="tab" href="#tab-request-data">请求内容</a></li>
			<li><a data-toggle="tab" href="#tab-log-time">操作时间</a></li>
			<li><a data-toggle="tab" href="#tab-ip">来源IP</a></li>

        </ul>
        <div class="tab-content">
			<div id="tab-resource-name" class="tab-pane active">
                <table class="table table-striped datatable">
                    <thead>
                    <tr>
                        <th>资源名称</th>
                        <th>数量</th>
                        <th>占比</th>
                        <th>&nbsp;</th>
                    </tr>
                    </thead>
                    <tbody>
                    <?php if ($this->dataResourceName): 
                    foreach ($this->dataResourceName as $d): 
                        $percent = sprintf('%.2f', 100 * $d->count / $this->totalRowsCount);
                    ?>
                    <tr>
                        <td><?php echo $d->resource_name ?></td>
                        <td><?php echo $d->count ?></td>
                        <td><?php echo $percent ?>%</td>
                        <td>
                            <div class="progress progress-xs">
                                <div class="progress-bar" role="progressbar" 
                                    aria-valuenow="<?php echo $percent ?>" aria-valuemin="0" 
                                    aria-valuemax="100" style="width: <?php echo $percent ?>%;">
                                    <span class="sr-only"><?php echo $percent ?>%</span>
                                </div>
                            </div>
                        </td>
                    </tr>
                    <?php endforeach; endif; ?>
                    </tbody>
                    <tfoot>
                    </tfoot>
                </table>
            </div>
			<div id="tab-sys-user-name" class="tab-pane">
                <table class="table table-striped datatable">
                    <thead>
                    <tr>
                        <th>用户名称</th>
                        <th>数量</th>
                        <th>占比</th>
                        <th>&nbsp;</th>
                    </tr>
                    </thead>
                    <tbody>
                    <?php if ($this->dataSysUserName): 
                    foreach ($this->dataSysUserName as $d): 
                        $percent = sprintf('%.2f', 100 * $d->count / $this->totalRowsCount);
                    ?>
                    <tr>
                        <td><?php echo $d->sys_user_name ?></td>
                        <td><?php echo $d->count ?></td>
                        <td><?php echo $percent ?>%</td>
                        <td>
                            <div class="progress progress-xs">
                                <div class="progress-bar" role="progressbar" 
                                    aria-valuenow="<?php echo $percent ?>" aria-valuemin="0" 
                                    aria-valuemax="100" style="width: <?php echo $percent ?>%;">
                                    <span class="sr-only"><?php echo $percent ?>%</span>
                                </div>
                            </div>
                        </td>
                    </tr>
                    <?php endforeach; endif; ?>
                    </tbody>
                    <tfoot>
                    </tfoot>
                </table>
            </div>
			<div id="tab-request-data" class="tab-pane">
                <table class="table table-striped datatable">
                    <thead>
                    <tr>
                        <th>请求内容</th>
                        <th>数量</th>
                        <th>占比</th>
                        <th>&nbsp;</th>
                    </tr>
                    </thead>
                    <tbody>
                    <?php if ($this->dataRequestData): 
                    foreach ($this->dataRequestData as $d): 
                        $percent = sprintf('%.2f', 100 * $d->count / $this->totalRowsCount);
                    ?>
                    <tr>
                        <td><?php echo $d->request_data ?></td>
                        <td><?php echo $d->count ?></td>
                        <td><?php echo $percent ?>%</td>
                        <td>
                            <div class="progress progress-xs">
                                <div class="progress-bar" role="progressbar" 
                                    aria-valuenow="<?php echo $percent ?>" aria-valuemin="0" 
                                    aria-valuemax="100" style="width: <?php echo $percent ?>%;">
                                    <span class="sr-only"><?php echo $percent ?>%</span>
                                </div>
                            </div>
                        </td>
                    </tr>
                    <?php endforeach; endif; ?>
                    </tbody>
                    <tfoot>
                    </tfoot>
                </table>
            </div>
			<div id="tab-log-time" class="tab-pane">
                <table class="table table-striped datatable">
                    <thead>
                    <tr>
                        <th>操作时间</th>
                        <th>数量</th>
                        <th>占比</th>
                        <th>&nbsp;</th>
                    </tr>
                    </thead>
                    <tbody>
                    <?php if ($this->dataLogTime): 
                    foreach ($this->dataLogTime as $d): 
                        $percent = sprintf('%.2f', 100 * $d->count / $this->totalRowsCount);
                    ?>
                    <tr>
                        <td><?php echo $d->log_time ?></td>
                        <td><?php echo $d->count ?></td>
                        <td><?php echo $percent ?>%</td>
                        <td>
                            <div class="progress progress-xs">
                                <div class="progress-bar" role="progressbar" 
                                    aria-valuenow="<?php echo $percent ?>" aria-valuemin="0" 
                                    aria-valuemax="100" style="width: <?php echo $percent ?>%;">
                                    <span class="sr-only"><?php echo $percent ?>%</span>
                                </div>
                            </div>
                        </td>
                    </tr>
                    <?php endforeach; endif; ?>
                    </tbody>
                    <tfoot>
                    </tfoot>
                </table>
            </div>
			<div id="tab-ip" class="tab-pane">
                <table class="table table-striped datatable">
                    <thead>
                    <tr>
                        <th>来源IP</th>
                        <th>数量</th>
                        <th>占比</th>
                        <th>&nbsp;</th>
                    </tr>
                    </thead>
                    <tbody>
                    <?php if ($this->dataIp): 
                    foreach ($this->dataIp as $d): 
                        $percent = sprintf('%.2f', 100 * $d->count / $this->totalRowsCount);
                    ?>
                    <tr>
                        <td><?php echo $d->ip ?></td>
                        <td><?php echo $d->count ?></td>
                        <td><?php echo $percent ?>%</td>
                        <td>
                            <div class="progress progress-xs">
                                <div class="progress-bar" role="progressbar" 
                                    aria-valuenow="<?php echo $percent ?>" aria-valuemin="0" 
                                    aria-valuemax="100" style="width: <?php echo $percent ?>%;">
                                    <span class="sr-only"><?php echo $percent ?>%</span>
                                </div>
                            </div>
                        </td>
                    </tr>
                    <?php endforeach; endif; ?>
                    </tbody>
                    <tfoot>
                    </tfoot>
                </table>
            </div>

        </div>
    </div>
</div>